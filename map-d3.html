
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>CS360/560 Final Project</title>

        <!-- Required CSS files -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/owl.carousel.css">
    <link rel="stylesheet" href="assets/css/barfiller.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="https://www.jq22.com/jquery/font-awesome.4.7.0.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/slicknav.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
    <script src="https://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="https://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
    <link rel="stylesheet" href="d3-style.css">
</head>

<body>
    <div class="preloader">
        <span class="preloader-spin"></span>
    </div>
    <div class="site">
		<header id="header">
			<div class="container">
				<div class="row">
					<div class="col-6 col-sm-3 logo-column">
						<h3><a href="index.html" class="logo">Final Project</a></h3>
					</div>
					<div class="col-6 col-sm-9 nav-column clearfix">
						<nav id="menu" class="d-none d-lg-block">
							<ul>
								<li><a href="index.html">Home</a></li>
								<li class="current-menu-item"><a href="dataset.html">DataSet</a></li>
                <li><a href="phototype.html">Phototype</a></li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</header>
		<main id="main">
			<div class="page-title sp" style="background-image: url(assets/img/home-banner.jpg);background-size: cover">
				<div class="container text-center">
					<!-- <h2>About D3 Implementation</h2> -->
					<!-- <p>For this project, we will collect data from Fire Departmemt.</p> -->
				</div>
			</div>
			<div class="about-area sp">
				<div class="container content-main">
					<h4>Map Implementation</h4>
          <p>Visualize the <a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">“ SF 311 dataset”. </a>
          Filtering the dataset to show cases that were OPENED in the month of February 2020 only and its Category is <strong>Residential Building Request</strong>. </p>
          <p>In basemap,I use <strong>current police districts</strong> as a map projection and shows the Boundaries of difference districts.</p>
          <p>I choose <strong>choropleth map</strong> to visualize the dateset. I rollup the "residential building request" cases by districts
          and visualize a numerical value using fill colr for that region.</p>
          <hr>
          <h4>Visualization Writeup</h4>
          <ul>
            <li><strong>Encoding: </strong>The number of cases in different districts is encoded by the depth of filled color, so greener color represents higher number of cases.</li>
            <li><strong>Interactivity: </strong>
            <ul>
                <li><strong>Hovering And Tooltips: </strong>show details when the mouse hovers over a region and/or symbol.</li>
                <li><strong>Zooming And Panning:: </strong>Allow users to zoom in on a region (either mouse scroll or click) and pan (drag) the view while zoomed in.</li>
            </ul>
          </li>
            <li><strong>Wrangling: </strong>Filtering the dataset to show cases that were OPENED in the month of February 2020 only and its Category is Residential Building Request</li>
            <li><strong>Conclusion: </strong>The map shows the northern district and central district have more number of 311 cases which is residental building request. But I think
            using or calculate a per sq ft or per ratio will be more accurately.</li>
          </ul>

          <br>

          <figure>
            <h1>US Electional Map Sized by Electional Votes</h1>
            <div id="body">
              <div class="main-container">
                <div id="#date-slider-container" data-role="fieldcontain">
                  <span id="date-slider-value-label" class="label">Year: </span><span id="date-slider-value"></span>
                  <span id="date-slider-min-label"></span>
                  <input type="range" name="date-slider" id="date-slider" value="25" min="0" max="100" style="display:none;"/>
                  <span id="date-slider-max-label"></span>
                  </div>
              </div>

                <div class="side-container">
                <div class="bar-chart-header">
                  	<span id="bar-chart-state-label">State: NewYork</span>
                </div>

                </div>
              <div id="main-container">
				            <!-- <div id="cartogram"> </div> -->
                      <svg width="650" height="500" id="vis"></svg>
			        </div>
              <!-- bar chart -->
              <div id="side-container">
                <div id="vote-chart">
                    <svg width="380" height="300" id="vis_bar"></svg>
                </div>
                <div id="side-details">

                </div>
              </div>
            </div>
            <br>
          <!-- <svg width="960" height="600" id="vis">
            <g id = "basemap"></g>
          </svg> -->

         <figcaption>
           Source: <a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">311 Department cases Reports: February 2020</a> (<a href="https://data.sfgov.org/City-Infrastructure/311-Cases/vw6y-z8j6">Police District</a>)
         </figcaption>
        </figure>

        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://d3js.org/topojson.v2.min.js"></script>
        <script src="https://d3js.org/d3-geo.v1.min.js"></script>


        <script type="text/javascript">
          //add details widget
          const details = d3.select("body").select("#side-details")
                            .append("foreignObject")
                            .attr("id", "details")
                            .attr("width", 300)
                            .attr("height", 200)
                            .attr("x", 800)
                            .attr("y", 800);

          const body_detail = details.append("xhtml:body")
                                      .style("text-align", "center")
                                      .style("background", "none")
                                      .html("<p>N/A</p>");

          details.style("visibility", "hidden");





          // draw basemap
          const svg_vis = d3.select("body").select("svg#vis");
          const g = {
            basemap: svg_vis.select("g#basemap")
          };

          // tooltip
          const tip = svg_vis.append("text").attr("id", "tooltip");
          tip.attr("text-anchor", "end");
          tip.attr("dx", -5);
          tip.attr("dy", -5);
          tip.style("visibility", "hidden");

          let projection = d3.geoAlbersUsa()
                              .scale(800)
                              .translate([650/2,500/2]);

          let path = d3.geoPath().projection(projection);
          d3.json("dataset/us_states.json").then(function(us){
            // console.log(us);
          svg_vis.selectAll('.states')
              	.data(topojson.feature(us, us.objects.usStates).features)
              	.enter()
              	.append('path')
              	.attr('class', 'states')
              	.attr('d', path)
              	.on('mouseover', function(d,i){
                  d3.select(this).raise().style('fill-opacity', 0.5);
                  d3.select(this).raise();
                  const html = `
                        <p>States Name:${d.properties.STATE_ABBR}</p>
                        <table border="0" cellspacing="0" cellpadding="2">
                        <tbody>
                          <tr>
                            <th>Incident:</th>
                            <td>${d.properties.STATE_ABBR}</td>
                          </tr>

                        </tbody>
                        </table>
                      `;

                      body_detail.html(html);
                      details.style("visibility", "visible");
		              })
                .on('mouseout', function(d, i) {
                    d3.selectAll('.states').raise()
                            .style('fill-opacity',1);
                })
              ;

            // deal with data
            let time_format = d3.timeFormat("%Y");
            let time_parse = d3.timeParse("%d-%m-%Y");


            let margins_arr =[];
            let map = new Map();
            let state_bar_arr = new Map();
            let x_domian_arr = [];
            let y_domian_arr = [];


            d3.csv("dataset/us_elections.csv").then(clearData);

            function clearData(data){
              let filter_by_states = data.filter(function(d,i){
                return d.Abbrev == "FL";
              })


              filter_by_states.forEach((item, i) => {
                    x_domian_arr[i]= time_format(time_parse(item.Year));
                    y_domian_arr[i]= parseFloat(item.MarginofVictory);
                    state_bar_arr.set(time_format(time_parse(item.Year)),parseFloat(item.MarginofVictory));
                });
              // console.log(x_domian_arr.sort());
              // console.log(state_bar_arr);

            // filter by year
              data = data.filter(function(d,i){
                return time_format(time_parse(d.Year)) == 2004;
              })

              // console.log(data.length);
              data.forEach((item, i) => {
                    margins_arr[i]=parseFloat(item.MarginofVictory);
                    item.ElectoralVotes =parseInt(item.ElectoralVotes);
                    map.set(item.Abbrev,i);
                });



              //color
              const color= d3.scaleQuantile()
                             .domain([-50,50])
                             .range(["brown","steelblue"]);


              const states_outline = svg_vis.selectAll(".states")
                                            .style("fill",function(d){
                                              var id = map.get(d.properties.STATE_ABBR)
                                                 return color(parseFloat(margins_arr[id]))
                                              });

              svg_vis.selectAll(".states")
                      .on("mourseover",function(d){
                        d3.select(this).raise();
                        const html = `
                              <table border="0" cellspacing="0" cellpadding="2">
                              <tbody>
                                <tr>
                                  <th>Incident:</th>
                                  <td>${d.properties.STATE_ABBR}</td>
                                </tr>

                              </tbody>
                              </table>
                            `;

                            body_details.html(html);
                            details.style("visibility", "visible");
                          });


                //
                // svg_vis.selectAll(".states").on("mouseout", function(d) {
                //         d3.select(this).classed("active", false);
                //         details.style("visibility", "hidden");
                //         });




              // draw bar chart
              let margin = {
                top:20,
                right: 20,
                left:40,
                bottom:30
              }

              let bar_svg = d3.select("body").selectAll("svg#vis_bar");

              bar_svg.width = 380;
              bar_svg.height = 300;

              let plot_width = bar_svg.width - margin.right - margin.left;
              let plot_height = bar_svg.height- margin.top - margin.bottom;

              // console.log("height:",plot_height);


              // we need our data as an array of key, value pairs before binding
              console.log( state_bar_arr);
              let pairs = Array.from(state_bar_arr);

              pairs.sort(function(a,b){
                return a[0]-b[0];
              })

              console.log("y_domain",d3.min(y_domian_arr));
              let x = d3.scaleBand()
                                .domain(x_domian_arr.sort())
                                .rangeRound([0,plot_width])
                                .paddingInner(0.1);

               let y = d3.scaleLinear()
                                   .domain([d3.min(y_domian_arr),d3.max(y_domian_arr)])
                                   .range([plot_height,0])
                                   .nice();
              //
              // console.log("ydomain",state_bar_arr.values());
               let plot_bar = bar_svg.append("g").attr("id","plot_bar");

               plot_bar.attr("transform","translate("+margin.left+","+ margin.top+")");

               let xAxis = d3.axisBottom(x);
               let yAxis = d3.axisLeft(y);

               let xGroup = plot_bar.append("g").attr("id","x-axis");
               xGroup.call(xAxis);
               xGroup.attr("transform","translate(0,"+ plot_height+")");

               let yGroup = plot_bar.append("g").attr("id","y-axis");
               yGroup.call(yAxis);
               // yGroup.attr("transform", "translate("+plot_width+",0)");


               console.log("pairs: ",pairs);
               let bars = bar_svg.selectAll("rect")
                                  .data(pairs,function(d){
                                    return d;});

               bars.enter()
                       .append("rect")
                       .attr("class",function(d){return "bar-"+(d[1]>0 ? "positive":"negative");})
                       .attr("width",x.bandwidth())
                       .attr("x",d => x(d[0]))
                       .attr("y",function(d) { return y(Math.max(0, d[1])); })
                       .attr("height",function(d){
                          return Math.abs(y(d[1]) - y(0));
                       })
                       .attr("transform", "translate(40,0)");

              bars.enter()
                  .append("text")
                  .text(d=>d[1]+"%")
                  .attr("x",d => x(d[0]))
                  .attr("y",function(d) { return y(Math.max(0, d[1])); })
                  .attr("transform", function(d){
                    if(d[1]>0){
                      return "translate(40,0)";
                    }else{
                      return  "translate(40,"+(Math.abs(y(d[1]) - y(0))+15)+")";
                    }
                  })
                  .attr("font-size",".8em")
                  ;

             }


          });




        </script>
				</div>
			</div>
		</main>
		<footer>
			<div class="footer-bottom">
				<div class="container">
					<div class="row">
						<div class="col-lg-6">
							<div class="copyright-txt">
								Copyright &copy; 2020. All rights reserved.
							</div>
						</div>
						<div class="col-lg-6 text-right">
							<div class="footer-nav">
								<a href="index.html">Home</a>
								<a href="dataset.html">Dataset</a>
								<a href="data.html">Data</a>
								<a href="team.html">Team</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
    </div>

    <!--Required JS files-->
<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<script src="assets/js/vendor/popper.min.js"></script>
<script src="assets/js/vendor/bootstrap.min.js"></script>
<script src="assets/js/vendor/owl.carousel.min.js"></script>
<script src="assets/js/vendor/isotope.pkgd.min.js"></script>
<script src="assets/js/vendor/jquery.barfiller.js"></script>
<script src="assets/js/vendor/loopcounter.js"></script>
<script src="assets/js/vendor/slicknav.min.js"></script>
<script src="assets/js/active.js"></script>

</body>

</html>
