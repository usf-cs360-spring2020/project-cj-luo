
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>CS360/560 Final Project Dataset</title>

  <!-- Required CSS files -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/owl.carousel.css">
  <link rel="stylesheet" href="assets/css/barfiller.css">
  <link rel="stylesheet" href="assets/css/animate.css">
  <link rel="stylesheet" href="https://www.jq22.com/jquery/font-awesome.4.7.0.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/slicknav.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <link rel="stylesheet" href="scatter.css">
</head>

<body>
  <div class="preloader">
    <span class="preloader-spin"></span>
  </div>
  <div class="site">
    <header id="header">
      <div class="container">
        <div class="row">
          <div class="col-6 col-sm-3 logo-column">
            <h3><a href="index.html" class="logo">Final Project</a></h3>
          </div>
          <div class="col-6 col-sm-9 nav-column clearfix">
            <nav id="menu" class="d-none d-lg-block">
              <ul>
                <li><a href="index.html">Home</a></li>
                <li class="current-menu-item"><a href="dataset.html">DataSet</a></li>
                <li class="has-child">
                  <a href="#">Phototype</a>
                  <ul class="sub-menu">
                    <li><a href="phototype_alpha.html"><i class="fa fa-pie-chart"></i> Alpha Release </a></li>
                    <li><a href="phototype.html"><i class="fa fa-area-chart"></i> Beta Release </a></li>
                  </ul>
                </li>
                <li class="has-child">
                  <a href="#">D3 implementation</a>
                  <ul class="sub-menu">
                    <li><a href="map-d3.html"><i class="fa fa-pie-chart"></i> Election Map</a></li>
                    <li><a href="scatter.html"><i class="fa fa-area-chart"></i> Election Scatter Chart</a></li>
                  </ul>
                </li>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </header>
  <main id="main">
    <div class="page-title sp" style="background-image: url(assets/img/home-banner.jpg);background-size: cover">
      <div class="container text-center">
        <!-- <h2>About Dataset</h2> -->
        <!-- <p>For this project, we will collect data from Fire Departmemt.</p> -->
      </div>
    </div>
    <div class="about-area sp">
      <div class="container content-main">
        <h4>Visualizing US Election By County(2004 to 2016) </h4>
        <p>In my continuing understand patterns of different states, I know most of states will consistently voted to
          specific party, and the same few swing states usually decide the election. And I want to figure out which county will impact
          the election and how these county changes their seats over time?</p>
          <ul>
            <li>
              <h6>Context</h6>
              <ul>
                <li>
                  <p><strong>Voter turnout</strong>: Voter turnout is the percentage of eligible voters who cast a ballot in an election.In this dataset age and citizenship status are the criteria used to determine eligibility,.</p>
                </li>
                <li><p><strong>Voters:</strong> The total number of eligible Voters.</p></li>
                <li>
                  <li><p><strong>Margin: </strong>Margins: The "margin" of A over B is the number of votes saying A>B, minus the number saying B>A.</p></li>
                </li>
              </ul>

            </li>
            <li>
              <h6>Encoding</h6>
              <p>Area encodong: Bubble areas are proportional to the fraction of votes. If you choose state,
                the number of voters are national voters. If you slect county,
                the number of voters are the eligible voters in that county.The circle more big means there are more voters.</p>
              <p>Color encoding: The red is represents the Republic Party and the blue represents Democrat party. The more close
                middle yScale means the more swing fraction. When circle more chose to boundary, these county or states have less possibilty to change their seats.
               </p>
            </li>
            <li>
              <h6>Interactivity</h6>
              <ul>
                <li>Filter: Click through years to see the changes in margin and turnout.
                  Search by state or county to view a subset of counties. For example, if you want to check all the  counties in the CA, search CA and then select county.
                Clear button to chear the filter.</li>
                  <li>Tooltips: Tooltips show both the county level and state level data on mouseover. It will show the county name/state name, county/state turnout, voters and D/R margin percentage.</li>
                </ul>
              </li>

              <br>
              <br>
              <br>
              <div id="svg_div">

              </div>
              <div class="year-button">
                <button class="incrbtn" id="upclick">&#9650;</button>
                <button class="incrbtn" id="downclick">&#9660;</button>
              </div>
              <br>
              <br>
              <br>
              <ul>
              <!-- <li>
                <strong>Instruction</strong>
                <p>The left-right sorting is especially apparent in Midwestern swing states that gave the election to Trump.
                  Try searching for WI(Wisconsin), PA, MI, IA, MN and clicking through the years to see this sorting in action.</p>
              </li> -->
              <li>
                <h6>Conclusion</h6>
                <p>Since the number of counties are too much, it is hard to find a specific or absolute conclusion. We can draw some conclusions from this
                scatter plot. The counties with more population which means with larger circle area will be less likely to change their seat and also will align to Democrat, vice viersa,
              the relative smallest counties also consistently support Republican. You can search Texas, California to give it a shot.</p>
              <p> When we want to see how these counties vote over time, using year button localted in the right-buttom of svg to observe the change will be the best way.
              </p>
                </li>
              </ul>

              <div id="formholder" >
                <div id="select">
                  <select id="inds">
                    <option value="county" selected="selected" >County</option>
                    <option value="state" >State</option>
                    <!-- <option value="race">Race</option>
                    <option value="gender">Gender</option>
                    <option value="age">Age</option>
                    <option value="education">Education</option> -->
                  </select>
                </div>
                <span id="searchform" name="myform">
                  <input type="text" id="myVal" size="30" placeholder="CA,FL,WI, Los Angeles County">
                  <input id="search" name="Submit" type="button" value="Search" onclick="handleClick();">   <!--onclick="handleClick();"-->
                  <input type="button" value="Clear" onclick="reset();" >  <!--document.myform.reset();-->
                  <!-- </form> -->
                </span>
                <!-- <form id="areaform">
                  Weight:
                  <input type="radio" name="area" value="vote"  checked>Vote
                  <!-- <input type="radio" name="area" value="electoral" > Electoral
                  <input type="radio" name="area" value="vpi" >VPI<br> -->
                <!-- </form> -->
              <div class="tooltip"></div>
            </div>
          </div>
        </div>

        <script type="text/javascript">
        var margin = {top: 30, right:20,bottom: 50, left:50};
            width = 1060 -margin.left - margin.right;
            height= 600 - margin.top - margin.bottom;

        // globals:
        var currentSearch= "";
        var searchTerms="";
        var selection ="county";
        var year;
        var cache = {};
        var d_vote = [251,365,332,227]
        var r_vote = [286,173,206,304]
        var d_percent =[48.28,52.93,50.99,48.15]
        var r_percent = [50.72,45.67,47.14,46.05]


        //data urls
        var urls = {
          'county': './dataset/US_County_Level_Presidential_Results_04-16.csv',// data from county level
          'state': './dataset/US_State_Level_Presidential_Results_04-16.csv', // datat from state level
        }

        var percentageFormat = d3.format(".2%");// 0.1233 = 12.34%
        var thousandFormat = d3.format(",");

        function capitalize(string){
          return string.charAt(0).toUpperCase()+string.slice(1);// make the fist letter capitalize
          //string.slice(1)means get string from index1 including index1
        }

        var svg = d3.select("body")
                    .select("#svg_div")
                    .append("svg")
                    .attr("width",width+margin.left+margin.right)
                    .attr("height",height+margin.top+ margin.bottom)
                    .append("g")
                    .attr("transform","translate("+ margin.left+","+margin.top+")");

        //add year title
        var title = svg.append("text")
                       .attr("class","title")
                       .attr("dy",height-10)//set offset to y position
                       .attr("dx",".35em");//.35em will add half the height of the text to the x dimension

        var demtext = svg.append("text")
                       .attr("class","party")
                       .attr("dy",height-50)
                       .attr("dx",243)
                       .text("D");

        var reptext = svg.append("text")
                      .attr("class","party")
                      .attr("dy",height-14)
                      .attr("dx",243)
                      .text("R");

        var xScale = d3.scaleLinear()
                       .domain([-100,100])
                       .range([0,width]);

        var yScale = d3.scaleLinear()
                      .domain([0,100])
                      .range([height,0]); // from height  0 is the top

        var xAxis = d3.axisBottom(xScale);
        var yAxis = d3.axisLeft(yScale);


        var xGroup= svg.append("g")
             .attr("class","axis")
             .attr("transform","translate(0,"+height+")")
             .call(xAxis)
             .append("text")
             .attr("y","3em")
             .attr("x",width/2)
             .text("Voting Margin(%)");

        var yGroup= svg.append("g")
             .attr("class","axis")
             .attr("transform","translate("+width/2+","+"0)")
             .call(yAxis)
             .append("text")
             .attr("y",30)
             .attr("dy","-3.75em")
             // .attr("x",width/2)
             .style("text-anchor","end")
             .text("Turnout(%)")

        //add tootlip
        var tooltip = d3.select("#formholder")
                        .append("div")
                        .style("position","absolute")
                        .style("visibility","hidden")
                        .attr("class","tootlip");

        d3.select("#inds").on("change",function(){
          var sel = document.getElementById("inds");
          selection = sel.options[sel.selectedIndex].value;//sets a global

          switch (selection) {
            case "county":
              renderCounties();
              break;
            case "state":
              renderStates();
              break;
            default:
          }
        });

    // get the data from a specify year
        function getYearData(dataset, year) {
          for (var i=0; i<dataset.length; i++) {
            if (Number(dataset[i].key) === year) {
              return dataset[i].values;
            }
          }
        }

        function copyObj(original) {
          return JSON.parse(JSON.stringify(original));
        }

        var colorScale = d3.scaleLinear()
        .domain([-50, 0, 50])
        .range(["#B2182B","#B7B7B7","#2166AC"])
        // .interpolate(d3.interpolateRgb);//interpolateRdYlBu


        //end  for healper function

        // handle search function
        function reset(){
          document.getElementById("myVal").value ='';// myVal is an input
          handleClick();
        }


        // event :  this event is actually an object containnibg information about the action that just happened
        //when you are interested in some event however, it's when you add an event listener to the element
        //element.addEventListener(eventName,handler) evenmane is a string and it's the nane of the event you are interested in
        //the handleer is simply a function which does something when event happens
        //event is just a regular javascript object, with lots of properties on it.
        function handleClick(){
          currentSearch = document.getElementById("myVal").value;
          // console.log("currrentSearch: ",currrentSearch);
          // split function return an array of words, map( ) method creates a new array populated with the results if calling a provided function on every element in the calling array
          var words= currentSearch.split(",").map(function(d){return d.trim()});

          searchTerms= RegExp(words.join('|'),"g");// gi for case insensitive, g just for global
          // console.log("result after the RegExp: ",searchTerms);
          // console.log(selection);

          d3.selectAll("circle").each(function(d){
            var circle = d3.select(this);
            // console.log(d);
            // console.log(selection);
            switch (selection) {
              case 'county':
                var field = d.county_name;
                var count = d.county_num
                break;
              //
              case 'state':
                var field = d.state;
                var count = d.num_state;
                break;
              default:

            }


            if ( (field.search(searchTerms) != -1) || (currentSearch == "") ) {   //(d.county.search(searchTerms) != -1)
              circle.style('pointer-events', 'auto');
              if(selection=='county'){
                circle.attr("fill", colorScale(((d.dem_num-d.rep_num)/count)*100));
              }else{
                circle.attr("fill", colorScale(((d.num_dem-d.num_rep)/count)*100));
              }
              circle.style("stroke-opacity", 1);
            } else {
              circle.style('pointer-events', 'none');
              circle.attr("fill", "rgba(192,192,192,0.05)");
              circle.style("stroke-opacity", 0);
            }

          })
          return false;
        }


        function renderCounties(){
          if(cache.counties){
            build(cache.counties);
          }else{
            d3.csv(urls.county).then(function(data){
              data.forEach((d, i) => {
                d.county_name = d.county_name+d.state;
                d.id = d.fips_code;
                d.dem_margin = d.dem_margin*100;
              });

              cache.counties = data;
              console.log(data);
              build(data);
            });
          }

          // function parseRows(d) {
          //   return {'county': d.county_name + ', ' + d.state, 'state': d.state, 'county_num': +d.county_num, 'turnout': +d.turnout,
          //   'num_rep': +d.rep_num, 'num_dem': +d.dem_num, 'year': +d.year, 'state_electoral_votes': +d.state_electoral_votes,
          //   'vap': +d.vap, 'id': +d.fips_code, 'dem_margin': +d.dem_margin*100};
          // }
          function tooltipOn(d){
            tooltip.style("visibility", "visible")
            // console.log(d);
            .html( // br for line break
              d.county_name + "<br>" +
              "County: D: " + percentageFormat(d.dem_num/d.county_num) +
              " R: " + percentageFormat(d.rep_num/d.county_num) + "<br>" +
              "Turnout: " + percentageFormat(d.turnout) + "<br>" +
              "Voters: " + thousandFormat(Math.round(d.county_num)) + "<br>" +
              "State: D: " + percentageFormat(d.num_state_dem/d.num_state) +
              " R: " + percentageFormat(d.num_state_rep/d.num_state) +  "<br>" );
          }
          //https://github.com/d3/d3-collection
          //Nesting allows elements in an array to be grouped into a hierachical tree struture
          //the resulting output is a tree rather than a flat table.
          // the levels in the tree are specified by key functions
          //an optional rollup function will collaspe the elements in each leaf node using a summery function
          function build(data){
            // console.log(data);
            var stateData = d3.nest()
                              .key(function(d){return d.year;})
                              .key(function(d){return d.state;})// two keys two levels
                              .rollup(function(v){// specifies a rollup function to be applied on each group of leaf elements
                                return{
                                  'num_state': d3.sum(v,function(d){return d.county_num;}),
                                  'num_state_dem': d3.sum(v,function(d){return d.dem_num;}),
                                  'num_state_rep': d3.sum(v,function(d){return d.rep_num;})
                                };
                              })
                              .object(data);// applies the nest operator to the specified array, returning a nested object
            // console.log(stateData);
            data.forEach(function(d){
              d.num_state = stateData[d.year][d.state]['num_state'],
              d.num_state_dem = stateData[d.year][d.state]['num_state_dem'],
              d.num_state_rep = stateData[d.year][d.state]['num_state_rep']
            });


            var dataset = d3.nest()
                            .key(function(d){return +d.year;})
                            .sortValues(function(a,b){return b.county_num-a.county_num;})
                            .object(data);

            var years = Object.keys(dataset).map(Number);
            years.sort();
            year = year ? year: 2016;
            // console.log("year",year);
            var yearData = copyObj(dataset[String(year)]);
            // console.log("checkhere",dataset[String(year)]);
            var rScale = d3.scaleLinear()
                           .domain([0,d3.max(data,function(d){
                             return Math.sqrt((d.county_num/Math.PI))
                           })])
                           .range([1,35]);

            // console.log(stateData);// empty

            function upclick() {
              year += 4;
              if (year > years[years.length - 1]) {
                year = years[0]
              }
              //Assign to new object, update circles:
              yearData = copyObj(dataset[String(year)]);
              // console.log("upclick",yearData);
              update(yearData, year);
            }

            function downclick() {
              year -= 4;
              if (year < years[0]) {
                year = years[years.length - 1];
              }
              yearData = copyObj(dataset[String(year)]);
              update(yearData, year);
            }

            d3.select('#upclick').on("click", upclick);
            d3.select('#downclick').on("click", downclick);

            let zoom = d3.zoom()
                         .scaleExtent([.5,20])
                         .extent([0,0],[width,height])
                         .on("zoom",zoomed);

             var circles = svg.selectAll("circle")
             .data(yearData, function(d) { return d.id ; });  // Key for object constancy: https://bost.ocks.org/mike/constancy/


            function update(yearData, year) {

              var d_vote = [252,365,332,232]
              var r_vote = [286,173,206,306]
              var d_percent =[48.28,52.93,50.99,48.15]
              var r_percent = [50.72,45.67,47.14,46.05]
              var index = (year-2004)/4

              demtext.text('D ' + d_percent[index]+'%' + ' ' + d_vote[index])
              reptext.text('D ' + r_percent[index]+'%' + ' ' + r_vote[index])

              //Update title
              title.text(year);

              var circles = svg.selectAll("circle")
              .data(yearData, function(d) { return d.id ; });  // Key for object constancy: https://bost.ocks.org/mike/constancy/

              circles.exit().remove();

              circles.enter().append("circle")
              .on("mouseover", tooltipOn) //Add tooltip before transition
              .on("mouseout", function(d){return tooltip.style("visibility", "hidden");})
              // .call(drag)
              .attr("class", "circle")
              .merge(circles)
              .transition()
              .duration(1000) //750;  1000
              .attr("cx", function(d) {
                return xScale(((d.dem_num-d.rep_num)/d.county_num)*100);
              })
              .attr("cy", function(d) {
                return yScale(d.turnout*100);
              })
              .attr("r", function(d) {
                return rScale(Math.sqrt(d.county_num/Math.PI));
              })
              .attr("fill",function(d){
                if (d.county_name.search(searchTerms) != -1) {
                  return colorScale(((d.dem_num-d.rep_num)/d.county_num)*100);
                }else {
                  return "rgba(192,192,192,0.05)";
                }
              });


            }
            function initialize(yearData, year) {
              //Update title
              title.text(year);
              var index = (year-2004)/4

              demtext.text('D ' + d_percent[index]+'%' + ' ' + d_vote[index])
              reptext.text('R ' + r_percent[index]+'%' + ' ' + r_vote[index])

              var circles = svg.selectAll("circle")
              .data(yearData, function(d) { return d.id ; });  // Key for object constancy: https://bost.ocks.org/mike/constancy/
              //
              circles.exit().remove();

              //Create any new circlesd
              circles.enter().append("circle")
              .attr("class", "circle")
              .attr("cx", function(d) {
                return xScale(((d.dem_num-d.rep_num)/d.county_num)*100);
              })
              .attr("cy", function(d) {
                return yScale(d.turnout*100);
              })
              .attr("r", function(d) {
                return rScale(Math.sqrt(d.county_num/Math.PI));
              })
              .attr("fill",function(d){
                // console.log(d);
                if (d.county_name.search(searchTerms) != -1) {
                  return colorScale(((d.dem_num-d.rep_num)/d.county_num)*100);
                }else {
                  return "rgba(192,192,192,0.05)";
                }
              })
              .call(zoom)
              .on("mouseover", tooltipOn)
              .on("mouseout", function(d){return tooltip.style("visibility", "hidden");});

            }
            //Initialize scatterplot
            initialize(yearData, year);
            svg.call(zoom).call(zoom.transform, d3.zoomIdentity);
            function zoomed(){
              let newXScale = d3.event.transform.rescaleX(xScale)
              let newYScale = d3.event.transform.rescaleY(yScale)
              console.log(newXScale);
              xAxis.scale(newXScale);
              xGroup.call(xAxis);
              yAxis.scale(newYScale);
              yGroup.call(yAxis);
              // console.log(yearData);
              circles.data(yearData)
                     .attr('cx',function(d){return newXScale(d.x)})
                     .attr('cy',function(d){return newYScale(d.y)})

            }// end for zoomed

          }//end for build data

        }//end for renderCouties

//___________________render states ___________________________________________________________________________
        function renderStates(){
          if(cache.states){
            build(cache.states)
          }else{
            d3.csv(urls.state).then(function(data){
              data.forEach((d, i) => {
                d.id = d.state
                d.turnout = d.num_state/d.vap
              });

              cache.states = data;
              build(data);
            });
          }

        function tooltipOn(d){
          tooltip.style("visibility", "visible")
          .html( // br for line break
            "State: "+d.state + "<br>" +
            "D: " + percentageFormat(d.num_dem/d.num_state) +
            " R: " + percentageFormat(d.num_rep/d.num_state) + "<br>" +
            "Turnout: " + percentageFormat(d.turnout) + "<br>" +
            "Voters: " + thousandFormat(Math.round(d.num_state)) + "<br>"  );
        }

        function build(data) {
          var circles;
          var dataset = d3.nest()
          .key(function(d) { return +d.year; })
          .sortValues(function(a,b) { return b.num_state - a.num_state; } )  //Bring smallest to front
          .object(data);
          //.entries(data);


          var years = Object.keys(dataset).map(Number);
          years.sort()
          //var year = years[0];
          year = year ? year : years[years.length-1];

          //Create a copy, so it can be edited on drag:
          var yearData = copyObj(dataset[String(year)]);

          //Data is just array of all objects from csv, used to find max of all years
          var rScale = d3.scaleLinear()
          .domain([0, d3.max(data, function(d) {return Math.sqrt(d.num_state/Math.PI); })])  //Area proportional to votes
          .range([1, 35]);  //2,60  2, 30

          function upclick() {
            year += 4;
            if (year > years[years.length - 1]) {
              year = years[0]
            }
            //Assign to new object, update circles:
            getYearData(dataset, year);
            //yearData = Object.assign([], getYearData(dataset, year));
            yearData = copyObj(dataset[String(year)]);
            // console.log("upclick",yearData);
            update(yearData, year);
          }

          function downclick() {
            year -= 4;
            if (year < years[0]) {
              year = years[years.length - 1];
            }
            // console.log("downclick",yearData);
            yearData = copyObj(dataset[String(year)]);
            update(yearData, year);
          }

          d3.select('#upclick').on("click", upclick);
          d3.select('#downclick').on("click", downclick);

          let zoom = d3.zoom()
                       .scaleExtent([.5,20])
                       .extent([0,0],[width,height])
                       .on("zoom",zoomed);

          function update(yearData, year) {


            var index = (year-2004)/4

            demtext.text('D ' + d_percent[index]+'%' + ' ' + d_vote[index])
            reptext.text('R ' + r_percent[index]+'%' + ' ' + r_vote[index])

            //Update title
            title.text(year);
            // the update process- enter() update exit( )
            //the basic principle follows 4 Stephens
            //1. defined group and join the data 2 exit, remove to get rid of any redundant DOM newelements
            //enter. append new DOM elements and then mergen the DOM elements

            var circles = svg.selectAll("circle")
            .data(yearData, function(d) { return d.id ; });  // Key for object constancy: https://bost.ocks.org/mike/constancy/

            circles.exit().remove();

            circles.enter().append("circle")
            .on("mouseover", tooltipOn) //Add tooltip before transition
            .on("mouseout", function(d){return tooltip.style("visibility", "hidden");})
            .attr("class", "circle")
            .merge(circles)
            .transition()
            .duration(1000) //750;  1000
            .attr("cx", function(d) {
              return xScale(((d.num_dem-d.num_rep)/d.num_state)*100);
            })
            .attr("cy", function(d) {
              return yScale(d.turnout*100);
            })
            .attr("r", function(d) {
              return rScale(Math.sqrt(d.num_state/Math.PI));
            })
            .attr("fill",function(d){
              if (d.state.search(searchTerms) != -1) {
                return colorScale(((d.num_dem-d.num_rep)/d.num_state)*100);
              }else {
                return "rgba(192,192,192,0.05)";
              }
            });


          }//end for update

          function initialize(yearData, year) {

            // console.log(yearData);
            // console.log(year)

            var index = (year-2004)/4

            demtext.text('D ' + d_percent[index]+'%' + ' ' + d_vote[index])
            reptext.text('D ' + r_percent[index]+'%' + ' ' + r_vote[index])

            //Update title
            title.text(year);

            circles = svg.selectAll("circle")
            .data(yearData, function(d) { return d.id ; });  // Key for object constancy: https://bost.ocks.org/mike/constancy/

            circles.exit().remove(); //.transition().duration(100);

            //Create any new circles
            circles.enter().append("circle")
            .attr("class", "circle")
            .attr("cx", function(d) {
              return xScale(((d.num_dem-d.num_rep)/d.num_state)*100);
            })
            .attr("cy", function(d) {
              // console.log(d);
              return yScale(d.turnout*100);
            })
            .attr("r", function(d) {
              //return rScale(Math.sqrt(d.num_state/Math.PI));
              return rScale(Math.sqrt(d.num_state/Math.PI));
            })
            .attr("fill",function(d){
              if (d.state.search(searchTerms) != -1) {
                return colorScale(((d.num_dem-d.num_rep)/d.num_state)*100);
              }else {
                return "rgba(192,192,192,0.05)";
              }
            })
            .call(zoom)
            .on("mouseover", tooltipOn)
            .on("mouseout", function(d){return tooltip.style("visibility", "hidden")  ;});

          }// end for initialize


          //Initialize scatterplot
          initialize(yearData, year);
          // var ci = d3.selectAll("circle");
          // console.log(ci);
          // svg.call(zoom);
          //update(yearData, year);  //Works, but transition is weird.

          function zoomed(){
            let newXScale = d3.event.transform.rescaleX(xScale)
            let newYScale = d3.event.transform.rescaleY(yScale)

            xAxis.scale(newXScale);
            xGroup.call(xAxis);
            yAxis.scale(newYScale);
            yGroup.call(yAxis);

            // join.merge(newelements)
            //     .attr("cx", d=>newXScale(+d.wight))
            //     .attr("cy",d=>newYScale(+d.height))
            circles.data(yearData,function(d) { return d.id ; })
                   .attr('cx',function(d){
                     console.log(d);
                     return newXScale(((d.num_dem-d.num_rep)/d.num_state)*100);})
                   .attr('cy',function(d){return newYScale(d.turnout*100)})

          }// end for zoomed

        } // end for build function

        }//end of render states




        renderCounties();
        // renderStates();



</script>
  </main>
  <footer>
    <div class="footer-bottom">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <div class="copyright-txt">
              Copyright &copy; 2020. All rights reserved.
            </div>
          </div>
          <div class="col-lg-6 text-right">
            <div class="footer-nav">
              <a href="index.html">Home</a>
              <a href="dataset.html">Dataset</a>
              <a href="data.html">Data</a>
              <a href="team.html">Team</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
</div>

<!--Required JS files-->
<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<script src="assets/js/vendor/popper.min.js"></script>
<script src="assets/js/vendor/bootstrap.min.js"></script>
<script src="assets/js/vendor/owl.carousel.min.js"></script>
<script src="assets/js/vendor/isotope.pkgd.min.js"></script>
<script src="assets/js/vendor/jquery.barfiller.js"></script>
<script src="assets/js/vendor/loopcounter.js"></script>
<script src="assets/js/vendor/slicknav.min.js"></script>
<script src="assets/js/active.js"></script>

</body>

</html>
